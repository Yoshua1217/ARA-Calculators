<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARA – Location & Orientation (Demo)</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#121821; --muted:#8aa0b3; --text:#e6eef7; --accent:#6bb8ff; --green:#35d399; --amber:#ffcc66; --edge:#1d2633; --pill:#192334;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;background:#0b0f14;color:var(--text)}
    .wrap{max-width:820px;margin:32px auto;padding:16px}
    .title{font-weight:700;font-size:24px;letter-spacing:.3px;margin:0 0 8px}
    .muted{color:var(--muted)}.card{background:var(--card); border:1px solid var(--edge); border-radius:20px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
.row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.spacer{flex:1}
.chip{padding:6px 10px;border-radius:999px;background:var(--pill);font-size:12px;color:var(--muted);border:1px solid var(--edge)}
.status{font-weight:700}
.acc{padding:8px 12px;border-radius:999px;background:var(--pill);font-size:16px;border:1px solid var(--edge)}
.acc.gray{color:#c7d2de}
.acc.amber{color:var(--amber)}
.acc.green{color:var(--green)}

.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
button{appearance:none;border:1px solid var(--edge);background:#162031;color:var(--text);padding:12px 16px;border-radius:12px;cursor:pointer;font-weight:600}
button:hover{border-color:#29405c}
.primary{background:linear-gradient(180deg,#1b2a40,#162031);}
button:disabled{opacity:.6;cursor:default}

.grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; margin-top:14px}
.cell{background:#0f1520;border:1px solid var(--edge);border-radius:14px;padding:10px}
.label{font-size:12px;color:var(--muted);margin-bottom:6px}
.value{font-feature-settings:"tnum" 1, "lnum" 1; font-variant-numeric:tabular-nums; font-size:16px}

.toolbar{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
.toggle{display:flex;align-items:center;gap:8px;background:#0f1520;border:1px solid var(--edge);padding:8px 10px;border-radius:12px;font-size:13px}
.toggle input{accent-color:var(--accent)}

.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#0f1520;border:1px solid var(--edge);padding:10px 14px;border-radius:12px;color:var(--text);opacity:0;pointer-events:none;transition:opacity .2s, transform .2s}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-4px)}

.hl{outline:2px solid var(--accent);outline-offset:2px;border-radius:8px}

@media (max-width:700px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
@media (max-width:420px){ .grid{grid-template-columns:1fr} }

  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">ARA – Location & Orientation (Demo)</h1>
    <p class="muted">Single‑page preview. Use HTTPS on a phone for real GPS. Haptics simulated with <code>navigator.vibrate</code>.</p><section class="card" id="card">
  <div class="row">
    <div class="chip">Location & Orientation</div>
    <div class="chip status" id="status">Idle</div>
    <div class="acc gray" id="accPill">± — m</div>
    <div class="spacer"></div>
    <div class="chip" id="timer">00:00</div>
  </div>

  <div class="btns">
    <button class="primary" id="btnFix">Get Fix</button>
    <button class="primary" id="btnLive">Live Track</button>
    <button id="btnSave">Save</button>
    <button id="btnCopy">Copy</button>
  </div>

  <div class="grid">
    <div class="cell"><div class="label">Latitude</div><div class="value" id="lat">—</div></div>
    <div class="cell"><div class="label">Longitude</div><div class="value" id="lon">—</div></div>
    <div class="cell"><div class="label">Accuracy</div><div class="value" id="accVal">—</div></div>
    <div class="cell"><div class="label">Altitude</div><div class="value" id="alt">—</div></div>
    <div class="cell"><div class="label">Heading</div><div class="value" id="head">—</div></div>
    <div class="cell"><div class="label">Speed</div><div class="value" id="speed">—</div></div>
    <div class="cell"><div class="label">Timestamp</div><div class="value" id="ts">—</div></div>
    <div class="cell"><div class="label">Form Lat (#lat)</div><div class="value" id="formLat">—</div></div>
    <div class="cell"><div class="label">Form Lon (#lon)</div><div class="value" id="formLon">—</div></div>
  </div>

  <div class="toolbar">
    <span class="muted">Settings:</span>
    <label class="toggle"><input type="checkbox" id="optHigh" checked> High accuracy</label>
    <label class="toggle"><input type="checkbox" id="optHaptics" checked> Haptics</label>
    <label class="toggle"><input type="checkbox" id="optAutofill" checked> Autofill form fields</label>
    <label class="toggle"><input type="checkbox" id="optPersistent"> Persistent watch</label>
  </div>

  <details>
    <summary>What am I seeing?</summary>
    <p class="muted">Live Track streams positions from the browser Geolocation API. Accuracy updates in real time as fixes improve. Buttons **Save** and **Copy** operate on the most recent reading. **Save** also stops Live Track.</p>
  </details>
</section>

<!-- Simulated ARA form inputs so you can see autofill -->
<section class="card" style="margin-top:16px">
  <div class="row"><div class="chip">Demo Form</div></div>
  <div class="grid">
    <div class="cell"><div class="label">#lat</div><input id="latInput" class="value" placeholder="lat"/></div>
    <div class="cell"><div class="label">#lon</div><input id="lonInput" class="value" placeholder="lon"/></div>
    <div class="cell"><div class="label">#gps_accuracy_m</div><input id="accInput" class="value" placeholder="accuracy m"/></div>
  </div>
</section>

  </div>  <div class="toast" id="toast">Saved</div>  <script>
    // --- Helpers ---
    const $ = (id)=>document.getElementById(id);
    const fmt = (n, d=6)=> (typeof n === 'number' && isFinite(n)) ? n.toFixed(d) : '—';
    const fmtInt = (n)=> (typeof n === 'number' && isFinite(n)) ? Math.round(n).toString() : '—';
    const fmt1 = (n)=> (typeof n === 'number' && isFinite(n)) ? n.toFixed(1) : '—';
    const toastEl = $('toast');
    function toast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'), 1400); }

    // Haptics (browser demo): Vibration API
    const H = {
      get enabled(){ return $('optHaptics').checked; },
      impact(level){ if(!this.enabled||!('vibrate' in navigator)) return; const m = {light:15, medium:30, heavy:50}; navigator.vibrate(m[level]||20); },
      success(){ if(!this.enabled||!('vibrate' in navigator)) return; navigator.vibrate([10,20,10]); },
      selection(){ if(!this.enabled||!('vibrate' in navigator)) return; navigator.vibrate(8); }
    };

    // State
    let watchId = null; let liveStart = 0; let timerInt = null; let bestAcc = Infinity; let lastPaint = 0;
    const statusEl = $('status'); const accPill = $('accPill'); const timerEl = $('timer');
    const out = { lat: $('lat'), lon: $('lon'), acc: $('accVal'), alt: $('alt'), head: $('head'), speed: $('speed'), ts: $('ts'), formLat: $('formLat'), formLon: $('formLon') };
    const inputs = { lat: $('latInput'), lon: $('lonInput'), acc: $('accInput') };

    // UI helpers
    function setAccPill(m){
      const txt = (isFinite(m)) ? `± ${fmt1(m)} m` : '± — m';
      accPill.textContent = txt;
      accPill.className = 'acc ' + (!isFinite(m) ? 'gray' : (m<=5?'green':(m<=20?'amber':'gray')));
      out.acc.textContent = isFinite(m) ? `${fmt1(m)} m` : '—';
      inputs.acc.value = isFinite(m) ? fmt1(m) : '';
    }
    function setStatus(s){ statusEl.textContent = s; }
    function updateTimer(){
      if(!liveStart){ timerEl.textContent = '00:00'; return; }
      const sec = Math.floor((Date.now()-liveStart)/1000);
      const mm = String(Math.floor(sec/60)).padStart(2,'0');
      const ss = String(sec%60).padStart(2,'0');
      timerEl.textContent = `${mm}:${ss}`;
    }
    function paint(pos){
      const now = Date.now(); if(now - lastPaint < 250) return; lastPaint = now;
      // Reset the timer on each successful position update
      liveStart = Date.now();
      if(!timerInt){ updateTimer(); timerInt = setInterval(updateTimer, 500); }
      const { latitude, longitude, accuracy, altitude, heading, speed } = pos.coords;
      out.lat.textContent = fmt(latitude);
      out.lon.textContent = fmt(longitude);
      setAccPill(accuracy);
      out.alt.textContent = isFinite(altitude) ? `${fmtInt(altitude)} m` : '—';
      out.head.textContent = (speed && speed>0.3 && isFinite(heading)) ? `${fmt1(heading)}°` : '—';
      out.speed.textContent = isFinite(speed) ? `${fmt1(speed)} m/s` : '—';
      out.ts.textContent = new Date(pos.timestamp || Date.now()).toLocaleString();

      if($('optAutofill').checked && isFinite(latitude) && isFinite(longitude)){
        const latStr = latitude.toFixed(6), lonStr = longitude.toFixed(6);
        inputs.lat.value = latStr; inputs.lon.value = lonStr; out.formLat.textContent = latStr; out.formLon.textContent = lonStr;
        inputs.lat.classList.add('hl'); inputs.lon.classList.add('hl'); setTimeout(()=>{inputs.lat.classList.remove('hl'); inputs.lon.classList.remove('hl');}, 350);
      }

      if(isFinite(accuracy) && accuracy + 0.5 < bestAcc){ H.selection(); bestAcc = accuracy; }
    }

    // Geolocation options
    function opts(){ return { enableHighAccuracy: $('optHigh').checked, maximumAge: 0, timeout: 15000 }; }

    // Actions
    function getFix(){
      if(!('geolocation' in navigator)) { toast('Geolocation not supported'); return; }
      setStatus('Fixing…'); H.impact('medium'); bestAcc = Infinity; setAccPill(NaN); $('btnFix').disabled = true; liveStart = 0; updateTimer();
      navigator.geolocation.getCurrentPosition(
        (pos)=>{ $('btnFix').disabled = false; setStatus('Idle'); paint(pos); H.success(); },
        (err)=>{ $('btnFix').disabled = false; setStatus('Denied'); toast(err.message||'Location failed'); H.impact('heavy'); },
        opts()
      );
    }
    function startLive(){
      if(!('geolocation' in navigator)){ toast('Geolocation not supported'); return; }
      if(watchId!==null) return;
      setStatus('Live'); bestAcc = Infinity; setAccPill(NaN); H.impact('medium');
      liveStart = Date.now(); updateTimer(); timerInt = setInterval(updateTimer, 500);
      $('btnLive').textContent = 'Stop';
      watchId = navigator.geolocation.watchPosition(
        (pos)=> paint(pos),
        (err)=> { toast(err.message||'Watch error'); },
        opts()
      );
    }
    function stopLive(){
      if(watchId!==null){ navigator.geolocation.clearWatch(watchId); watchId = null; }
      setStatus('Paused'); $('btnLive').textContent = 'Live Track'; H.impact('medium');
      if(timerInt){ clearInterval(timerInt); timerInt=null; }
      liveStart=0; updateTimer();
    }
    function copyCurrent(){
      const lat = out.lat.textContent, lon = out.lon.textContent, acc = out.acc.textContent, ts = out.ts.textContent;
      const str = `${lat}, ${lon} (± ${acc.replace(' m','')}) @ ${ts}`;
      navigator.clipboard?.writeText(str).then(()=>toast('Copied')).catch(()=>toast('Copy failed'));
    }

    // Wire up
    $('btnFix').addEventListener('click', getFix);
    $('btnLive').addEventListener('click', ()=>{ (watchId===null) ? startLive() : stopLive(); });
    $('btnSave').addEventListener('click', ()=>{ if(watchId!==null) stopLive(); H.success(); toast('Saved to form'); });
    $('btnCopy').addEventListener('click', copyCurrent);

    // Persistent watch demo
    document.addEventListener('visibilitychange', ()=>{
      if(document.visibilityState==='visible'){
        // no auto-resume; only if user enabled Persistent and we were paused
        if($('optPersistent').checked && watchId===null && statusEl.textContent==='Paused') startLive();
      } else {
        if(!$('optPersistent').checked && watchId!==null) stopLive();
      }
    });

    // Permission hint
    if('permissions' in navigator && navigator.permissions.query){
      navigator.permissions.query({name:'geolocation'}).then(p=>{ if(p.state==='denied') setStatus('Denied'); }).catch(()=>{});
    }
  </script></body>
</html>
